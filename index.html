<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>My Queen’s Student Page</title>
    <meta name="description" content="Hengyi Dong — Queen’s School of Computing student page">
    <link rel="stylesheet" href="style.css?v=5"/>
  </head>
  <body>
    <!-- Header 固定在最上方，粒子不覆蓋 -->
    <header id="site-header">
      <h1>Welcome to Hengyi's Blog</h1>
    </header>

    <!-- 粒子背景 -->
    <canvas id="bg"></canvas>

    <main>
      <section>
        <h2>About Me</h2>
        <p>
          I am a student at the Queen’s School of Computing with interests in
          Photography, Blender, Economics, small form factor PCs (Mini-ITX), and
          East Asian Literature.
        </p>
        <img src="me.jpeg" alt="My portrait" loading="lazy"/>
      </section>

      <section>
        <h2>Projects</h2>
        <ul>
          <li>Project One — one sentence description.</li>
          <li>Project Two — coming soon.</li>
        </ul>
      </section>

      <section>
        <h2>Contact</h2>
        <p>Email: <a href="mailto:hengyi.dong@queensu.ca">hengyi.dong@queensu.ca</a></p>
        <p>LinkedIn: <a href="#">To be Announced</a></p>
      </section>
    </main>

    <!-- 粒子動畫 -->
    <script>
    (() => {
      const header = document.getElementById('site-header');
      const c = document.getElementById('bg');
      const ctx = c.getContext('2d');
      const root = document.documentElement;

      // 統一使用 Queen's 黃色
      const GOLD = getComputedStyle(root).getPropertyValue('--gold').trim() || '#f2a900';

      let W, H, particles, maxDist, headerPx;
      const DPR = Math.min(window.devicePixelRatio || 1, 2);

      function measureHeader() {
        headerPx = Math.ceil(header.getBoundingClientRect().height);
        root.style.setProperty('--header-h', headerPx + 'px');
      }

      function resize() {
        measureHeader();
        W = c.width = Math.floor(window.innerWidth * DPR);
        H = c.height = Math.floor((window.innerHeight - headerPx) * DPR);

        const count = Math.min(200, Math.floor((W * H) / (14000 * DPR)));
        maxDist = Math.max(90 * DPR, Math.min(160 * DPR, Math.sqrt(W * H) / 28));

        particles = Array.from({ length: count }, () => ({
          x: Math.random() * W,
          y: Math.random() * H,
          vx: (Math.random() - 0.5) * (0.4 * DPR),
          vy: (Math.random() - 0.5) * (0.4 * DPR),
          r: 1.6 * DPR
        }));
      }

      function step() {
        ctx.clearRect(0, 0, W, H);

        // 顆粒 = 黃色
        ctx.fillStyle = GOLD;
        for (const p of particles) {
          p.x += p.vx; p.y += p.vy;
          if (p.x < 0 || p.x > W) p.vx *= -1;
          if (p.y < 0 || p.y > H) p.vy *= -1;
          ctx.beginPath();
          ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
          ctx.fill();
        }

        // 連線 = 黃色（透明度衰減）
        ctx.strokeStyle = GOLD;
        for (let i = 0; i < particles.length; i++) {
          for (let j = i + 1; j < particles.length; j++) {
            const a = particles[i], b = particles[j];
            const dx = a.x - b.x, dy = a.y - b.y;
            const d2 = dx*dx + dy*dy;
            if (d2 < maxDist*maxDist) {
              const t = 1 - Math.sqrt(d2) / maxDist;
              ctx.globalAlpha = 0.25 * t;
              ctx.lineWidth = Math.max(0.6 * DPR, 1.2 * t * DPR);
              ctx.beginPath();
              ctx.moveTo(a.x, a.y);
              ctx.lineTo(b.x, b.y);
              ctx.stroke();
              ctx.globalAlpha = 1;
            }
          }
        }

        requestAnimationFrame(step);
      }

      const reduced = window.matchMedia('(prefers-reduced-motion: reduce)');
      function start(){ if (!reduced.matches) requestAnimationFrame(step); }

      window.addEventListener('resize', resize);
      window.addEventListener('load', resize);
      const ro = new ResizeObserver(resize);
      ro.observe(header);

      resize(); start();

      document.addEventListener('visibilitychange', () => {
        if (!reduced.matches && document.visibilityState === 'visible') requestAnimationFrame(step);
      });
    })();
    </script>
  </body>
</html>
